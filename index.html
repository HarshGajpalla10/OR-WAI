<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IIM Ranchi ‚Äî MBA Timetable</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c10;
    --surface: #12151c;
    --surface2: #1a1f2b;
    --border: #252b38;
    --accent: #e8c547;
    --accent2: #4af0b8;
    --accent3: #f07070;
    --accent4: #7eb3ff;
    --text: #e8eaf0;
    --text-dim: #7a8299;
    --text-faint: #3a4155;
    --radius: 10px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  /* HEADER */
  .header {
    background: linear-gradient(135deg, #0d1117 0%, #12192a 50%, #0d1117 100%);
    border-bottom: 1px solid var(--border);
    padding: 24px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(12px);
  }
  .header-left { display: flex; align-items: center; gap: 16px; }
  .logo {
    width: 44px; height: 44px;
    background: var(--accent);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Space Mono', monospace;
    font-weight: 700;
    color: #0a0c10;
    font-size: 13px;
    letter-spacing: -1px;
  }
  .header h1 {
    font-size: 20px;
    font-weight: 800;
    letter-spacing: -0.5px;
  }
  .header h1 span { color: var(--accent); }
  .header-sub { font-size: 12px; color: var(--text-dim); font-family: 'Space Mono', monospace; }
  .badge {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 6px 14px;
    font-size: 12px;
    font-family: 'Space Mono', monospace;
    color: var(--accent2);
  }
  /* STATS BAR */
  .stats-bar {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 16px 32px;
    display: flex;
    gap: 32px;
    overflow-x: auto;
  }
  .stat {
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 120px;
  }
  .stat-val {
    font-size: 24px;
    font-weight: 800;
    color: var(--accent);
    font-family: 'Space Mono', monospace;
  }
  .stat-val.green { color: var(--accent2); }
  .stat-val.blue { color: var(--accent4); }
  .stat-val.red { color: var(--accent3); }
  .stat-label { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }
  /* CONTROLS */
  .controls {
    padding: 20px 32px;
    background: var(--bg);
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: flex-end;
    border-bottom: 1px solid var(--border);
  }
  .control-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .control-group label {
    font-size: 11px;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-family: 'Space Mono', monospace;
  }
  select, input {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text);
    padding: 8px 12px;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    min-width: 160px;
    cursor: pointer;
    outline: none;
    transition: border-color 0.2s;
  }
  select:hover, input:hover { border-color: var(--accent); }
  select:focus, input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(232,197,71,0.15); }
  input[type="search"] { min-width: 220px; }
  .btn {
    background: var(--accent);
    color: #0a0c10;
    border: none;
    border-radius: var(--radius);
    padding: 9px 18px;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 13px;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
  }
  .btn:hover { opacity: 0.85; }
  .btn:active { transform: scale(0.97); }
  .btn.secondary {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
  }
  /* TAB NAV */
  .tabs {
    display: flex;
    gap: 4px;
    padding: 16px 32px 0;
    border-bottom: 1px solid var(--border);
    background: var(--bg);
  }
  .tab {
    padding: 10px 20px;
    border-radius: 8px 8px 0 0;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    color: var(--text-dim);
    border: 1px solid transparent;
    border-bottom: none;
    transition: all 0.2s;
  }
  .tab.active {
    background: var(--surface);
    color: var(--accent);
    border-color: var(--border);
  }
  .tab:hover:not(.active) { color: var(--text); }
  /* MAIN CONTENT */
  .content { padding: 24px 32px; }
  .view { display: none; }
  .view.active { display: block; }
  /* WEEKLY GRID */
  .week-nav {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
  }
  .week-nav button {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    width: 36px; height: 36px;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: border-color 0.2s;
  }
  .week-nav button:hover { border-color: var(--accent); color: var(--accent); }
  .week-title {
    font-size: 18px;
    font-weight: 700;
  }
  .week-subtitle {
    font-size: 12px;
    color: var(--text-dim);
    font-family: 'Space Mono', monospace;
  }
  .room-alert {
    background: rgba(240,112,112,0.1);
    border: 1px solid rgba(240,112,112,0.3);
    border-radius: 8px;
    padding: 10px 16px;
    font-size: 12px;
    color: var(--accent3);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .room-alert.green {
    background: rgba(74,240,184,0.08);
    border-color: rgba(74,240,184,0.25);
    color: var(--accent2);
  }
  .room-alert.warning {
    background: rgba(232,197,71,0.1);
    border-color: rgba(232,197,71,0.3);
    color: var(--accent);
  }
  /* GRID TABLE */
  .grid-wrap { overflow-x: auto; border-radius: var(--radius); border: 1px solid var(--border); }
  .grid-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    min-width: 900px;
  }
  .grid-table th {
    background: var(--surface);
    padding: 10px 8px;
    text-align: center;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
    border-bottom: 1px solid var(--border);
    border-right: 1px solid var(--border);
    font-weight: 600;
  }
  .grid-table th.day-header {
    font-size: 12px;
    color: var(--text);
    font-weight: 700;
  }
  .grid-table td {
    border-bottom: 1px solid var(--border);
    border-right: 1px solid var(--border);
    vertical-align: top;
    padding: 4px;
    background: var(--bg);
    min-width: 120px;
    height: 80px;
  }
  .grid-table td:first-child {
    background: var(--surface);
    text-align: center;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    padding: 8px;
    min-width: 90px;
  }
  .session-chip {
    border-radius: 6px;
    padding: 4px 6px;
    margin-bottom: 2px;
    cursor: pointer;
    transition: opacity 0.15s, transform 0.1s;
    font-size: 10px;
    line-height: 1.3;
    border-left: 3px solid;
  }
  .session-chip:hover { opacity: 0.85; transform: scale(1.02); }
  .session-chip .chip-course { font-weight: 700; display: block; }
  .session-chip .chip-room { color: rgba(255,255,255,0.6); font-family: 'Space Mono', monospace; font-size: 9px; }
  /* Course list view */
  .course-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
  }
  .course-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    cursor: pointer;
    transition: border-color 0.2s, transform 0.15s;
  }
  .course-card:hover { border-color: var(--accent); transform: translateY(-2px); }
  .course-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
  }
  .course-code {
    background: var(--accent);
    color: #0a0c10;
    padding: 3px 8px;
    border-radius: 5px;
    font-size: 11px;
    font-weight: 700;
    font-family: 'Space Mono', monospace;
  }
  .course-sections-badge {
    font-size: 11px;
    color: var(--text-dim);
    font-family: 'Space Mono', monospace;
  }
  .course-name { font-size: 14px; font-weight: 700; margin-bottom: 6px; }
  .course-faculty { font-size: 12px; color: var(--text-dim); margin-bottom: 10px; }
  .course-meta {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .meta-chip {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 4px;
    font-family: 'Space Mono', monospace;
  }
  .meta-chip.enrollment { background: rgba(126,179,255,0.15); color: var(--accent4); }
  .meta-chip.progress { background: rgba(74,240,184,0.12); color: var(--accent2); }
  .progress-bar {
    background: var(--border);
    height: 3px;
    border-radius: 2px;
    margin-top: 10px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: var(--accent2);
    border-radius: 2px;
    transition: width 0.4s ease;
  }
  /* Room view */
  .room-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 16px;
  }
  .room-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
  }
  .room-title {
    font-size: 18px;
    font-weight: 800;
    font-family: 'Space Mono', monospace;
    color: var(--accent);
    margin-bottom: 4px;
  }
  .room-sessions { font-size: 12px; color: var(--text-dim); margin-bottom: 12px; }
  .util-bar {
    background: var(--border);
    height: 6px;
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 8px;
  }
  .util-fill {
    height: 100%;
    border-radius: 3px;
    background: linear-gradient(90deg, var(--accent2), var(--accent4));
  }
  .util-label { font-size: 11px; color: var(--text-dim); font-family: 'Space Mono', monospace; }
  /* Faculty view */
  .faculty-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .faculty-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 20px;
    cursor: pointer;
    transition: border-color 0.2s;
  }
  .faculty-card:hover { border-color: var(--accent4); }
  .faculty-avatar {
    width: 44px; height: 44px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent4), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    font-weight: 800;
    color: #0a0c10;
    flex-shrink: 0;
  }
  .faculty-info { flex: 1; }
  .faculty-name { font-size: 15px; font-weight: 700; }
  .faculty-courses { font-size: 12px; color: var(--text-dim); margin-top: 2px; }
  .faculty-load {
    text-align: right;
    font-family: 'Space Mono', monospace;
  }
  .faculty-sessions { font-size: 22px; font-weight: 700; color: var(--accent); }
  .faculty-sessions-label { font-size: 10px; color: var(--text-dim); }
  /* MODAL */
  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 200;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    width: min(700px, 95vw);
    max-height: 80vh;
    overflow-y: auto;
    padding: 28px;
    position: relative;
  }
  .modal-close {
    position: absolute;
    top: 16px; right: 16px;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    width: 32px; height: 32px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    display: flex; align-items: center; justify-content: center;
  }
  .modal-title { font-size: 20px; font-weight: 800; margin-bottom: 4px; }
  .modal-sub { font-size: 13px; color: var(--text-dim); margin-bottom: 20px; }
  .modal-sessions {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .modal-session-row {
    display: grid;
    grid-template-columns: 30px 90px 90px 80px 80px 1fr;
    gap: 12px;
    align-items: center;
    padding: 8px 10px;
    background: var(--surface2);
    border-radius: 8px;
    font-size: 12px;
  }
  .modal-session-row .sn { color: var(--text-faint); font-family: 'Space Mono', monospace; }
  .modal-session-row .week-badge {
    background: var(--accent);
    color: #0a0c10;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 700;
    font-family: 'Space Mono', monospace;
    text-align: center;
  }
  .scrollbar-none { scrollbar-width: none; }
  .scrollbar-none::-webkit-scrollbar { display: none; }
  /* Empty cell */
  .empty-cell { font-size: 11px; color: var(--text-faint); text-align: center; padding: 8px; }
  /* Analytics */
  .analytics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  @media (max-width: 768px) { .analytics-grid { grid-template-columns: 1fr; } .controls, .content, .header { padding: 16px; } }
  .chart-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; }
  .chart-title { font-size: 14px; font-weight: 700; margin-bottom: 16px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; font-family: 'Space Mono', monospace; }
  .bar-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
  .bar-label { font-size: 11px; min-width: 90px; color: var(--text-dim); font-family: 'Space Mono', monospace; }
  .bar-track { flex: 1; background: var(--border); height: 8px; border-radius: 4px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 4px; }
  .bar-value { font-size: 11px; min-width: 36px; text-align: right; font-family: 'Space Mono', monospace; color: var(--text-dim); }
  .heat-grid { display: grid; grid-template-columns: 50px repeat(7, 1fr); gap: 3px; }
  .heat-cell { height: 28px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-family: 'Space Mono', monospace; }
  .heat-label { font-size: 10px; color: var(--text-dim); display: flex; align-items: center; font-family: 'Space Mono', monospace; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="logo">IIM<br>R</div>
    <div>
      <h1>MBA <span>Timetable</span></h1>
      <div class="header-sub">Term 3 ¬∑ 10-Week Optimized Schedule</div>
    </div>
  </div>
  <div style="display:flex;gap:10px;align-items:center">
    <div class="badge" id="live-count">0 sessions</div>
  </div>
</div>

<div class="stats-bar scrollbar-none">
  <div class="stat"><div class="stat-val" id="stat-sessions">0</div><div class="stat-label">Sessions Scheduled</div></div>
  <div class="stat"><div class="stat-val green" id="stat-courses">27</div><div class="stat-label">Courses</div></div>
  <div class="stat"><div class="stat-val blue" id="stat-sections">47</div><div class="stat-label">Sections (incl. splits)</div></div>
  <div class="stat"><div class="stat-val" id="stat-faculty">25</div><div class="stat-label">Faculty Members</div></div>
  <div class="stat"><div class="stat-val green" id="stat-unscheduled">0</div><div class="stat-label">Unscheduled Sessions</div></div>
  <div class="stat"><div class="stat-val" style="color:var(--accent2)" id="stat-weeks">10</div><div class="stat-label">Term Weeks</div></div>
  <div class="stat"><div class="stat-val blue" id="stat-rooms">4</div><div class="stat-label">Classrooms</div></div>
</div>

<div class="controls">
  <div class="control-group">
    <label>Search</label>
    <input type="search" id="search-input" placeholder="Course, faculty, room...">
  </div>
  <div class="control-group">
    <label>Filter: Course</label>
    <select id="filter-course">
      <option value="">All Courses</option>
    </select>
  </div>
  <div class="control-group">
    <label>Filter: Faculty</label>
    <select id="filter-faculty">
      <option value="">All Faculty</option>
    </select>
  </div>
  <div class="control-group">
    <label>Filter: Day</label>
    <select id="filter-day">
      <option value="">All Days</option>
      <option>Mon</option><option>Tue</option><option>Wed</option>
      <option>Thu</option><option>Fri</option><option>Sat</option><option>Sun</option>
    </select>
  </div>
  <button class="btn" onclick="applyFilters()">Apply</button>
  <button class="btn secondary" onclick="resetFilters()">Reset</button>
</div>

<div class="tabs">
  <div class="tab active" onclick="switchTab('weekly')">üìÖ Weekly Grid</div>
  <div class="tab" onclick="switchTab('courses')">üìö Courses</div>
  <div class="tab" onclick="switchTab('faculty')">üë®‚Äçüè´ Faculty</div>
  <div class="tab" onclick="switchTab('rooms')">üè´ Rooms</div>
  <div class="tab" onclick="switchTab('analytics')">üìä Analytics</div>
</div>

<div class="content">

<div id="view-weekly" class="view active">
  <div class="week-nav">
    <button onclick="prevWeek()">‚Äπ</button>
    <div>
      <div class="week-title" id="week-title">Week 1</div>
      <div class="week-subtitle" id="week-subtitle">Days 1‚Äì7 of Term 3</div>
    </div>
    <button onclick="nextWeek()">‚Ä∫</button>
    <div style="margin-left:16px;display:flex;gap:8px;align-items:center">
      <span style="font-size:12px;color:var(--text-dim)">Jump to:</span>
      <select id="week-jump" onchange="jumpWeek()" style="min-width:100px">
        <option value="1">Week 1</option><option value="2">Week 2</option>
        <option value="3">Week 3</option><option value="4">Week 4</option>
        <option value="5">Week 5</option><option value="6">Week 6</option>
        <option value="7">Week 7</option><option value="8">Week 8</option>
        <option value="9">Week 9</option><option value="10">Week 10</option>
      </select>
    </div>
  </div>
  <div id="room-info-bar"></div>
  <div class="grid-wrap">
    <table class="grid-table" id="weekly-grid"></table>
  </div>
</div>

<div id="view-courses" class="view">
  <div class="course-grid" id="course-grid"></div>
</div>

<div id="view-faculty" class="view">
  <div class="faculty-list" id="faculty-list"></div>
</div>

<div id="view-rooms" class="view">
  <div class="room-grid" id="room-grid"></div>
</div>

<div id="view-analytics" class="view">
  <div class="analytics-grid" id="analytics-content"></div>
</div>

</div><div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal" id="modal-content">
    <button class="modal-close" onclick="closeModalBtn()">‚úï</button>
    <div id="modal-body"></div>
  </div>
</div>

<script>
let RAW_DATA = [{"week": 1, "day": "Fri", "slot": "10:30-12:00", "course": "PBM", "course_name": "Product & Brand Management", "section": "Sec A", "faculty": "Prof. Aditya Shankar Mishra", "room": "CR-01", "session": 1, "enrollment": 70}, {"week": 1, "day": "Sun", "slot": "13:30-15:00", "course": "PBM", "course_name": "Product & Brand Management", "section": "Sec B", "faculty": "Prof. Aditya Shankar Mishra", "room": "CR-01", "session": 1, "enrollment": 70}, {"week": 1, "day": "Tue", "slot": "10:30-12:00", "course": "DSMM", "course_name": "Digital & Social Media Marketing", "section": "Sec A", "faculty": "Prof. Subhro Sarkar", "room": "CR-01", "session": 1, "enrollment": 70}, {"week": 2, "day": "Wed", "slot": "16:30-18:00", "course": "DSMM", "course_name": "Digital & Social Media Marketing", "section": "Sec B", "faculty": "Prof. Subhro Sarkar", "room": "CR-01", "session": 1, "enrollment": 70}, {"week": 2, "day": "Wed", "slot": "09:00-10:30", "course": "SDM", "course_name": "Sales & Distribution Management", "section": "Sec A", "faculty": "Prof. Shibashish Chakraborty", "room": "CR-01", "session": 1, "enrollment": 69}, {"week": 3, "day": "Sat", "slot": "12:00-13:30", "course": "SDM", "course_name": "Sales & Distribution Management", "section": "Sec B", "faculty": "Prof. Shibashish Chakraborty", "room": "CR-01", "session": 1, "enrollment": 70}, {"week": 3, "day": "Tue", "slot": "09:00-10:30", "course": "CRM", "course_name": "Customer Relationship Management", "section": "Sec A", "faculty": "Prof. Ankur Jha", "room": "CR-01", "session": 1, "enrollment": 66}, {"week": 3, "day": "Thu", "slot": "15:00-16:30", "course": "CRM", "course_name": "Customer Relationship Management", "section": "Sec B", "faculty": "Prof. Ankur Jha", "room": "CR-01", "session": 1, "enrollment": 67}, {"week": 4, "day": "Mon", "slot": "12:00-13:30", "course": "CS", "course_name": "Corporate Strategy", "section": "Sec A", "faculty": "Prof. Swarup Kumar Dutta", "room": "CR-01", "session": 1, "enrollment": 64}, {"week": 4, "day": "Sat", "slot": "18:00-19:30", "course": "CS", "course_name": "Corporate Strategy", "section": "Sec B", "faculty": "Prof. Swarup Kumar Dutta", "room": "CR-01", "session": 1, "enrollment": 65}, {"week": 2, "day": "Wed", "slot": "16:30-18:00", "course": "IMKT", "course_name": "International Marketing", "section": "Sec A", "faculty": "Prof. Dipanjan Kumar Dey", "room": "CR-02", "session": 1, "enrollment": 62}, {"week": 5, "day": "Fri", "slot": "18:00-19:30", "course": "IMKT", "course_name": "International Marketing", "section": "Sec B", "faculty": "Prof. Dipanjan Kumar Dey", "room": "CR-01", "session": 1, "enrollment": 62}, {"week": 4, "day": "Sat", "slot": "18:00-19:30", "course": "IMC", "course_name": "Integrated Marketing Communication", "section": "Sec A", "faculty": "Prof. T. Sai Vijay", "room": "CR-02", "session": 1, "enrollment": 61}, {"week": 5, "day": "Sat", "slot": "16:30-18:00", "course": "IMC", "course_name": "Integrated Marketing Communication", "section": "Sec B", "faculty": "Prof. T. Sai Vijay", "room": "CR-01", "session": 1, "enrollment": 61}, {"week": 6, "day": "Tue", "slot": "12:00-13:30", "course": "FIS", "course_name": "Fixed Income Securities", "section": "Sec A", "faculty": "Prof. Prasenjit Chakrabarti", "room": "CR-01", "session": 1, "enrollment": 57}, {"week": 6, "day": "Fri", "slot": "10:30-12:00", "course": "FIS", "course_name": "Fixed Income Securities", "section": "Sec B", "faculty": "Prof. Prasenjit Chakrabarti", "room": "CR-01", "session": 1, "enrollment": 57}, {"week": 6, "day": "Fri", "slot": "10:30-12:00", "course": "CCS", "course_name": "Cooperative & Competitive Strategies", "section": "Sec A", "faculty": "Prof. Rohit Kumar", "room": "CR-02", "session": 1, "enrollment": 56}, {"week": 6, "day": "Sat", "slot": "18:00-19:30", "course": "CCS", "course_name": "Cooperative & Competitive Strategies", "section": "Sec B", "faculty": "Prof. Rohit Kumar", "room": "CR-01", "session": 1, "enrollment": 57}, {"week": 7, "day": "Sun", "slot": "12:00-13:30", "course": "CB", "course_name": "Consumer Behavior", "section": "Sec A", "faculty": "Prof. M. Jyotsna Soni", "room": "CR-01", "session": 1, "enrollment": 55}, {"week": 7, "day": "Wed", "slot": "18:00-19:30", "course": "CB", "course_name": "Consumer Behavior", "section": "Sec B", "faculty": "Prof. M. Jyotsna Soni", "room": "CR-01", "session": 1, "enrollment": 56}, {"week": 7, "day": "Wed", "slot": "18:00-19:30", "course": "DT", "course_name": "Digital Transformation", "section": "Sec A", "faculty": "Prof. Arindam Mukherjee", "room": "CR-02", "session": 1, "enrollment": 55}, {"week": 8, "day": "Mon", "slot": "10:30-12:00", "course": "DT", "course_name": "Digital Transformation", "section": "Sec B", "faculty": "Prof. Arindam Mukherjee", "room": "CR-01", "session": 1, "enrollment": 55}, {"week": 8, "day": "Wed", "slot": "12:00-13:30", "course": "IM", "course_name": "Investment Management", "section": "Sec A", "faculty": "Prof. Anand", "room": "CR-01", "session": 1, "enrollment": 54}, {"week": 9, "day": "Wed", "slot": "10:30-12:00", "course": "IM", "course_name": "Investment Management", "section": "Sec B", "faculty": "Prof. Anand", "room": "CR-01", "session": 1, "enrollment": 55}, {"week": 9, "day": "Fri", "slot": "12:00-13:30", "course": "DTI", "course_name": "Design Thinking & Innovation", "section": "Sec A", "faculty": "Prof. Rohit Kumar (Premid) + Prof. Rojers Puthur Josrph (Postmid)", "room": "CR-01", "session": 1, "enrollment": 51}, {"week": 9, "day": "Wed", "slot": "12:00-13:30", "course": "DTI", "course_name": "Design Thinking & Innovation", "section": "Sec B", "faculty": "Prof. Rohit Kumar (Premid) + Prof. Rojers Puthur Josrph (Postmid)", "room": "CR-01", "session": 1, "enrollment": 52}, {"week": 6, "day": "Tue", "slot": "12:00-13:30", "course": "EMPP", "course_name": "Empowering Managers through Positive Psychology", "section": "Sec A", "faculty": "Prof. Rajasekhar David", "room": "CR-02", "session": 1, "enrollment": 48}, {"week": 8, "day": "Wed", "slot": "12:00-13:30", "course": "EMPP", "course_name": "Empowering Managers through Positive Psychology", "section": "Sec B", "faculty": "Prof. Rajasekhar David", "room": "CR-02", "session": 1, "enrollment": 49}, {"week": 4, "day": "Mon", "slot": "12:00-13:30", "course": "PRI", "course_name": "Pricing", "section": "Sec A", "faculty": "Prof. Shweta Jha", "room": "CR-02", "session": 1, "enrollment": 48}, {"week": 10, "day": "Wed", "slot": "16:30-18:00", "course": "PRI", "course_name": "Pricing", "section": "Sec B", "faculty": "Prof. Shweta Jha", "room": "CR-01", "session": 1, "enrollment": 48}, {"week": 6, "day": "Sat", "slot": "18:00-19:30", "course": "DMPA", "course_name": "Data Mining & Predictive Analytics", "section": "Sec A", "faculty": "Prof. Pradip Kumar Bala", "room": "CR-02", "session": 1, "enrollment": 46}, {"week": 2, "day": "Wed", "slot": "09:00-10:30", "course": "DMPA", "course_name": "Data Mining & Predictive Analytics", "section": "Sec B", "faculty": "Prof. Pradip Kumar Bala", "room": "CR-02", "session": 1, "enrollment": 47}, {"week": 10, "day": "Mon", "slot": "18:00-19:30", "course": "PM", "course_name": "Project Management", "section": "Sec A", "faculty": "Prof. Vijaya Dixit", "room": "CR-01", "session": 1, "enrollment": 46}, {"week": 6, "day": "Tue", "slot": "12:00-13:30", "course": "SCM", "course_name": "Supply Chain Management", "section": "Sec B", "faculty": "Prof. Pritee Ray", "room": "CR-03", "session": 1, "enrollment": 41}, {"week": 10, "day": "Wed", "slot": "16:30-18:00", "course": "DRV", "course_name": "Derivatives", "section": "Sec A", "faculty": "Prof. Kamran Kuddus", "room": "CR-02", "session": 1, "enrollment": 36}, {"week": 1, "day": "Fri", "slot": "10:30-12:00", "course": "ODC", "course_name": "Organization Development & Change", "section": "Sec A", "faculty": "Prof. Viraj Varma", "room": "CR-02", "session": 1, "enrollment": 35}, {"week": 5, "day": "Fri", "slot": "18:00-19:30", "course": "ODC", "course_name": "Organization Development & Change", "section": "Sec B", "faculty": "Prof. Viraj Varma", "room": "CR-02", "session": 1, "enrollment": 36}, {"week": 5, "day": "Sat", "slot": "16:30-18:00", "course": "REE", "course_name": "Reigniting Employee Engagement", "section": "Sec A", "faculty": "Prof. Rakhi Singh", "room": "CR-02", "session": 1, "enrollment": 69}, {"week": 2, "day": "Wed", "slot": "09:00-10:30", "course": "NCM", "course_name": "Negotiation & Conflict Management", "section": "Sec A", "faculty": "Prof. Manish Kumar", "room": "CR-03", "session": 1, "enrollment": 68}, {"week": 3, "day": "Thu", "slot": "15:00-16:30", "course": "GMRM", "course_name": "Global Human Resource Management", "section": "Sec A", "faculty": "Prof. Piyali Ghosh", "room": "CR-02", "session": 1, "enrollment": 66}, {"week": 8, "day": "Mon", "slot": "10:30-12:00", "course": "SMTI", "course_name": "Strategic Mgmt of Technological Innovation", "section": "Sec A", "faculty": "Prof. Shiwangi Singh", "room": "CR-02", "session": 1, "enrollment": 64}, {"week": 7, "day": "Wed", "slot": "18:00-19:30", "course": "BV", "course_name": "Business Valuation", "section": "Sec A", "faculty": "Prof. Anand", "room": "CR-03", "session": 1, "enrollment": 53}, {"week": 3, "day": "Sat", "slot": "12:00-13:30", "course": "BMS", "course_name": "Business Model Strategy", "section": "Sec A", "faculty": "Prof. Santosh Kumar Prusty", "room": "CR-02", "session": 1, "enrollment": 48}];

const DAYS = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
const SLOTS = ['09:00-10:30','10:30-12:00','12:00-13:30','13:30-15:00','15:00-16:30','16:30-18:00','18:00-19:30'];

// --- DYNAMIC CONSTRAINT SCHEDULER (OVERLAP PROTECTION ENGINE) ---
// Enforces 4 Classrooms + 2 Sessions/Section/Week + ZERO Student/Faculty overlaps
const ROOMS = ['CR-01', 'CR-02', 'CR-03', 'CR-04'];
const NEW_DATA = [];
const uniqueSections = [];
const courseMetaMap = {};

// 1. Gather distinct courses and sections from the hardcoded list
RAW_DATA.forEach(d => {
  const key = d.course + '|' + d.section;
  if (!courseMetaMap[key]) {
    courseMetaMap[key] = { course: d.course, name: d.course_name, section: d.section, faculty: d.faculty, enrollment: d.enrollment };
    uniqueSections.push(courseMetaMap[key]);
  }
});

let sessionTrack = {};
uniqueSections.forEach(s => sessionTrack[s.course+'|'+s.section] = 0);

// 2. Distribute exactly 2 sessions per section over the 10 weeks across 4 rooms with strict overlap checks
for (let w = 1; w <= 10; w++) {
  let success = false;
  let bestAttempt = { data: [], track: {}, leftovers: 999 };
  let attempts = 0;

  // Since it's a tight packing problem (94 tasks into 94 valid cohort-slots per week), we use a retry loop
  while (!success && attempts < 500) {
    attempts++;
    let currentWeekData = [];
    let localSessionTrack = { ...sessionTrack };
    let tasks = [];
    
    uniqueSections.forEach(sec => {
      tasks.push(sec);
      tasks.push(sec); // 2 sessions per week per section
    });
    
    // Shuffle tasks to explore different packing configurations
    tasks.sort(() => Math.random() - 0.5);
    
    let timeslots = [];
    DAYS.forEach(day => {
      SLOTS.forEach(slot => {
        if (day === 'Sun' && SLOTS.indexOf(slot) >= 5) return; // Skip late Sunday slots
        timeslots.push({day, slot});
      });
    });
    
    // Attempt scheduling timeslot by timeslot
    timeslots.forEach(t => {
      let assignedRooms = 0;
      let busySections = new Set();  // Protects Student overlap
      let busyFaculties = new Set(); // Protects Faculty overlap
      let scheduledIndices = [];
      
      for (let i = 0; i < tasks.length && assignedRooms < 4; i++) {
        let task = tasks[i];
        
        // STRICT OVERLAP CHECK: Is the student group free? Is the faculty free?
        if (!busySections.has(task.section) && !busyFaculties.has(task.faculty)) {
          
          busySections.add(task.section);
          busyFaculties.add(task.faculty);
          
          localSessionTrack[task.course+'|'+task.section]++;
          currentWeekData.push({
            week: w,
            day: t.day,
            slot: t.slot,
            course: task.course,
            course_name: task.name,
            section: task.section,
            faculty: task.faculty,
            room: ROOMS[assignedRooms],
            session: localSessionTrack[task.course+'|'+task.section],
            enrollment: task.enrollment
          });
          
          scheduledIndices.push(i);
          assignedRooms++;
        }
      }
      
      // Remove successfully scheduled tasks from the queue (reverse order to keep indices intact)
      for (let i = scheduledIndices.length - 1; i >= 0; i--) {
        tasks.splice(scheduledIndices[i], 1);
      }
    });

    if (tasks.length === 0) {
      success = true;
      NEW_DATA.push(...currentWeekData);
      sessionTrack = localSessionTrack; // Commit progress
    } else if (tasks.length < bestAttempt.leftovers) {
      // Keep track of the tightest pack in case we fail all 500 attempts
      bestAttempt = { data: currentWeekData, track: localSessionTrack, leftovers: tasks.length };
    }
  }
  
  // Failsafe: if we couldn't perfectly pack it without overlap, use the best packing we found
  if (!success) {
    console.warn(`Week ${w} couldn't be perfectly packed without overlap. Dropped ${bestAttempt.leftovers} sessions.`);
    NEW_DATA.push(...bestAttempt.data);
    sessionTrack = bestAttempt.track;
  }
}

// Override RAW_DATA with the generated zero-overlap schedule
RAW_DATA = NEW_DATA;
// ----------------------------------------------------------------------

// Course color map
const COURSE_COLORS = {};
const COLOR_PALETTE = [
  ['#e8c547','#2a2410'],['#4af0b8','#0d2a20'],['#7eb3ff','#12203a'],
  ['#f07070','#2a1212'],['#c084fc','#1e1230'],['#fb923c','#2a1a0a'],
  ['#34d399','#0d2420'],['#f472b6','#2a0f1e'],['#a78bfa','#1a1030'],
  ['#fbbf24','#241c08'],['#38bdf8','#0a2030'],['#86efac','#0f2318'],
  ['#fca5a5','#2a1010'],['#fdba74','#2a1a08'],['#67e8f9','#0a2228'],
  ['#a3e635','#192208'],['#e879f9','#250a2a'],['#2dd4bf','#0a2220'],
  ['#818cf8','#12142a'],['#fb7185','#2a0d12'],['#d9f99d','#1c2208'],
  ['#fef08a','#2a2608'],['#99f6e4','#0a2220'],['#c4b5fd','#1a1430'],
  ['#fed7aa','#2a1e0a'],['#bfdbfe','#101e2a'],['#fecdd3','#2a1014']
];
const courses_list = [...new Set(RAW_DATA.map(d => d.course))].sort();
courses_list.forEach((c, i) => {
  COURSE_COLORS[c] = COLOR_PALETTE[i % COLOR_PALETTE.length];
});

// Update top statistics on load
document.getElementById('live-count').textContent = `${RAW_DATA.length} sessions`;
document.getElementById('stat-sessions').textContent = RAW_DATA.length;

// State
let currentWeek = 1;
let filters = { course: '', faculty: '', day: '', search: '' };

// Populate selects
const courseSelect = document.getElementById('filter-course');
const facultySelect = document.getElementById('filter-faculty');
courses_list.forEach(c => {
  const name = RAW_DATA.find(d => d.course === c).course_name;
  const opt = document.createElement('option');
  opt.value = c; opt.textContent = `${c} ‚Äì ${name}`;
  courseSelect.appendChild(opt);
});
const faculties = [...new Set(RAW_DATA.map(d => d.faculty))].sort();
faculties.forEach(f => {
  const opt = document.createElement('option');
  opt.value = f; opt.textContent = f;
  facultySelect.appendChild(opt);
});

function applyFilters() {
  filters.course = courseSelect.value;
  filters.faculty = facultySelect.value;
  filters.day = document.getElementById('filter-day').value;
  filters.search = document.getElementById('search-input').value.toLowerCase();
  renderCurrentTab();
}
function resetFilters() {
  filters = { course: '', faculty: '', day: '', search: '' };
  courseSelect.value = ''; facultySelect.value = '';
  document.getElementById('filter-day').value = '';
  document.getElementById('search-input').value = '';
  renderCurrentTab();
}
function getFiltered() {
  return RAW_DATA.filter(d => {
    if (filters.course && d.course !== filters.course) return false;
    if (filters.faculty && d.faculty !== filters.faculty) return false;
    if (filters.day && d.day !== filters.day) return false;
    if (filters.search) {
      const s = filters.search;
      if (!d.course.toLowerCase().includes(s) &&
          !d.course_name.toLowerCase().includes(s) &&
          !d.faculty.toLowerCase().includes(s) &&
          !d.room.toLowerCase().includes(s)) return false;
    }
    return true;
  });
}

// TAB MANAGEMENT
let currentTab = 'weekly';
function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab').forEach((t,i) => {
    const tabs = ['weekly','courses','faculty','rooms','analytics'];
    t.classList.toggle('active', tabs[i] === tab);
  });
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-'+tab).classList.add('active');
  renderCurrentTab();
}
function renderCurrentTab() {
  if (currentTab === 'weekly') renderWeeklyGrid();
  else if (currentTab === 'courses') renderCourses();
  else if (currentTab === 'faculty') renderFaculty();
  else if (currentTab === 'rooms') renderRooms();
  else if (currentTab === 'analytics') renderAnalytics();
}

// WEEKLY GRID 
function prevWeek() { if (currentWeek > 1) { currentWeek--; renderWeeklyGrid(); } }
function nextWeek() { if (currentWeek < 10) { currentWeek++; renderWeeklyGrid(); } }
function jumpWeek() { currentWeek = +document.getElementById('week-jump').value; renderWeeklyGrid(); }

function renderWeeklyGrid() {
  document.getElementById('week-jump').value = currentWeek;
  document.getElementById('week-title').textContent = `Week ${currentWeek}`;
  const startDay = (currentWeek - 1) * 7 + 1;
  document.getElementById('week-subtitle').textContent = `Days ${startDay}‚Äì${startDay+6} of Term 3 ¬∑ Zero Overlap Guaranteed`;

  const bar = document.getElementById('room-info-bar');
  const sessionCount = RAW_DATA.filter(d => d.week === currentWeek).length;
  
  if (sessionCount < 94) {
    bar.innerHTML = `<div class="room-alert warning">‚ö† Only <strong>${sessionCount}/94</strong> sessions could be scheduled this week due to tight faculty/student constraints.</div>`;
  } else {
    bar.innerHTML = `<div class="room-alert green">‚úì <strong>Perfect Packing</strong>: Zero faculty or student overlaps.</div>`;
  }

  const filtered = getFiltered().filter(d => d.week === currentWeek);
  const cellMap = {};
  DAYS.forEach(day => { cellMap[day] = {}; SLOTS.forEach((s,i) => { cellMap[day][i] = []; }); });
  filtered.forEach(d => {
    const si = SLOTS.indexOf(d.slot);
    if (si >= 0 && cellMap[d.day]) cellMap[d.day][si].push(d);
  });

  let html = '<thead><tr><th>Time Slot</th>';
  DAYS.forEach(day => { html += `<th class="day-header">${day}</th>`; });
  html += '</tr></thead><tbody>';

  SLOTS.forEach((slot, si) => {
    html += `<tr>`;
    html += `<td>${slot}</td>`;
    DAYS.forEach(day => {
      if (day === 'Sun' && si >= 5) {
        html += `<td style="background:var(--surface2);opacity:0.4"><div class="empty-cell">Unavail.</div></td>`;
        return;
      }
      const sessions = cellMap[day][si] || [];
      let cellHtml = '';
      if (sessions.length === 0) {
        cellHtml = `<div class="empty-cell">‚Äî</div>`;
      } else {
        sessions.forEach(s => {
          const [bg, fg] = COURSE_COLORS[s.course] || ['#666','#fff'];
          cellHtml += `<div class="session-chip" style="background:${bg}20;border-left-color:${bg};color:${fg === '#0a0c10' ? '#fff' : '#fff'}"
            onclick="showSessionModal('${s.course}','${s.section}',${s.week})">
            <span class="chip-course">${s.course} ${s.section}</span>
            <span class="chip-room">${s.room} ¬∑ S${s.session}</span>
          </div>`;
        });
      }
      html += `<td>${cellHtml}</td>`;
    });
    html += `</tr>`;
  });
  html += '</tbody>';
  document.getElementById('weekly-grid').innerHTML = html;
}

// COURSES VIEW
function renderCourses() {
  const filtered = getFiltered();
  const byCourse = {};
  filtered.forEach(d => {
    const key = d.course + '_' + d.section;
    if (!byCourse[key]) byCourse[key] = { ...d, count: 0 };
    byCourse[key].count++;
  });
  const grouped = {};
  Object.values(byCourse).forEach(c => {
    if (!grouped[c.course]) grouped[c.course] = [];
    grouped[c.course].push(c);
  });

  let html = '';
  const allCourses = [...new Set(RAW_DATA.map(d => d.course))].sort();
  allCourses.forEach(code => {
    const sections = grouped[code] || [];
    if (sections.length === 0 && (filters.course || filters.faculty || filters.search)) return;
    const info = RAW_DATA.find(d => d.course === code) || {};
    const allSections = [...new Set(RAW_DATA.filter(d => d.course === code).map(d => d.section))];
    const totalSched = Object.values(grouped[code] || {}).reduce((a,b) => a + b.count, 0);
    const needed = allSections.length * 20;
    const pct = Math.round(totalSched / needed * 100);
    const [bg] = COURSE_COLORS[code] || ['#888'];
    html += `<div class="course-card" onclick="showCourseModal('${code}')">
      <div class="course-card-header">
        <div class="course-code" style="background:${bg};color:#0a0c10">${code}</div>
        <div class="course-sections-badge">${allSections.join(' ¬∑ ')}</div>
      </div>
      <div class="course-name">${info.course_name || code}</div>
      <div class="course-faculty">${info.faculty || '‚Äî'}</div>
      <div class="course-meta">
        <div class="meta-chip enrollment">üë• ${info.enrollment} students</div>
        <div class="meta-chip progress">‚úì ${totalSched}/${needed} sessions</div>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:${pct}%;background:${bg}"></div></div>
    </div>`;
  });
  document.getElementById('course-grid').innerHTML = html;
}

// FACULTY VIEW
function renderFaculty() {
  const filtered = getFiltered();
  const byFaculty = {};
  filtered.forEach(d => {
    if (!byFaculty[d.faculty]) byFaculty[d.faculty] = { sessions: 0, courses: new Set(), name: d.faculty };
    byFaculty[d.faculty].sessions++;
    byFaculty[d.faculty].courses.add(d.course_name);
  });
  const sorted = Object.values(byFaculty).sort((a,b) => b.sessions - a.sessions);
  let html = '';
  sorted.forEach(f => {
    const initials = f.name.replace('Prof. ','').split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase();
    html += `<div class="faculty-card" onclick="showFacultyModal('${f.name.replace(/'/g,"\'")}')">
      <div class="faculty-avatar">${initials}</div>
      <div class="faculty-info">
        <div class="faculty-name">${f.name}</div>
        <div class="faculty-courses">${[...f.courses].slice(0,3).join(' ¬∑ ')}${f.courses.size > 3 ? ' +more' : ''}</div>
      </div>
      <div class="faculty-load">
        <div class="faculty-sessions">${f.sessions}</div>
        <div class="faculty-sessions-label">sessions</div>
      </div>
    </div>`;
  });
  document.getElementById('faculty-list').innerHTML = html;
}

// ROOMS VIEW 
function renderRooms() {
  const filtered = getFiltered();
  const byRoom = {};
  filtered.forEach(d => {
    if (!byRoom[d.room]) byRoom[d.room] = { sessions: 0, courses: new Set() };
    byRoom[d.room].sessions++;
    byRoom[d.room].courses.add(d.course);
  });
  const maxSessions = Math.max(...Object.values(byRoom).map(r => r.sessions), 1);
  const sorted = Object.entries(byRoom).sort((a,b) => a[0].localeCompare(b[0]));
  let html = '';
  sorted.forEach(([room, info]) => {
    const pct = Math.round(info.sessions / maxSessions * 100);
    html += `<div class="room-card">
      <div class="room-title">${room}</div>
      <div class="room-sessions">${info.sessions} sessions ¬∑ ${info.courses.size} courses</div>
      <div class="util-bar"><div class="util-fill" style="width:${pct}%"></div></div>
      <div class="util-label">Utilization: ${pct}%</div>
    </div>`;
  });
  document.getElementById('room-grid').innerHTML = html;
}

// ANALYTICS VIEW
function renderAnalytics() {
  const filtered = getFiltered();
  
  const weekCount = {};
  for (let w = 1; w <= 10; w++) weekCount[w] = 0;
  filtered.forEach(d => weekCount[d.week]++);
  const maxW = Math.max(...Object.values(weekCount));

  let weekBars = '';
  for (let w = 1; w <= 10; w++) {
    const pct = Math.round(weekCount[w] / maxW * 100);
    weekBars += `<div class="bar-row">
      <div class="bar-label">Week ${w}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:var(--accent2)"></div></div>
      <div class="bar-value">${weekCount[w]}</div>
    </div>`;
  }

  const dayCount = { Mon:0, Tue:0, Wed:0, Thu:0, Fri:0, Sat:0, Sun:0 };
  filtered.forEach(d => dayCount[d.day]++);
  const maxD = Math.max(...Object.values(dayCount));
  const dayColors = { Mon:'#7eb3ff', Tue:'#4af0b8', Wed:'#e8c547', Thu:'#c084fc', Fri:'#fb923c', Sat:'#f07070', Sun:'#f472b6' };
  let dayBars = '';
  Object.entries(dayCount).forEach(([day, count]) => {
    const pct = Math.round(count / maxD * 100);
    dayBars += `<div class="bar-row">
      <div class="bar-label">${day}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${dayColors[day]}"></div></div>
      <div class="bar-value">${count}</div>
    </div>`;
  });

  const courseCount = {};
  filtered.forEach(d => { courseCount[d.course] = (courseCount[d.course]||0) + 1; });
  const topCourses = Object.entries(courseCount).sort((a,b)=>b[1]-a[1]).slice(0,10);
  const maxC = Math.max(...topCourses.map(c=>c[1]));
  let courseBars = '';
  topCourses.forEach(([code, count]) => {
    const pct = Math.round(count / maxC * 100);
    const [bg] = COURSE_COLORS[code] || ['#888'];
    courseBars += `<div class="bar-row">
      <div class="bar-label">${code}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${bg}"></div></div>
      <div class="bar-value">${count}</div>
    </div>`;
  });

  const heatMap = {};
  DAYS.forEach(d => { heatMap[d] = {}; SLOTS.forEach((s,i) => heatMap[d][i] = 0); });
  filtered.forEach(d => {
    const si = SLOTS.indexOf(d.slot);
    if (si >= 0 && heatMap[d.day]) heatMap[d.day][si]++;
  });
  const maxH = Math.max(...DAYS.flatMap(d => SLOTS.map((_,i) => heatMap[d][i])));

  let heatHtml = '<div class="heat-grid">';
  heatHtml += '<div class="heat-cell heat-label"></div>';
  DAYS.forEach(day => { heatHtml += `<div class="heat-cell" style="font-size:10px;color:var(--text-dim);justify-content:center">${day}</div>`; });
  SLOTS.forEach((slot, si) => {
    heatHtml += `<div class="heat-label" style="font-size:9px;padding-right:4px">${slot.slice(0,5)}</div>`;
    DAYS.forEach(day => {
      if (day === 'Sun' && si >= 5) { heatHtml += `<div class="heat-cell" style="background:var(--surface2);opacity:0.3"></div>`; return; }
      const val = heatMap[day][si] || 0;
      const intensity = maxH > 0 ? val / maxH : 0;
      const alpha = 0.1 + intensity * 0.85;
      heatHtml += `<div class="heat-cell" style="background:rgba(74,240,184,${alpha.toFixed(2)});font-size:9px;color:${intensity > 0.5 ? '#0a2420' : 'var(--text-dim)'}">${val > 0 ? val : ''}</div>`;
    });
  });
  heatHtml += '</div>';

  document.getElementById('analytics-content').innerHTML = `
    <div class="chart-card">
      <div class="chart-title">Sessions per Week</div>
      ${weekBars}
    </div>
    <div class="chart-card">
      <div class="chart-title">Sessions per Day</div>
      ${dayBars}
    </div>
    <div class="chart-card">
      <div class="chart-title">Top 10 Courses by Sessions</div>
      ${courseBars}
    </div>
    <div class="chart-card">
      <div class="chart-title">Heatmap: Day √ó Time Slot</div>
      ${heatHtml}
    </div>
  `;
}

// MODALS
function showSessionModal(course, section, week) {
  const sessions = RAW_DATA.filter(d => d.course === course && d.section === section)
    .sort((a,b) => a.week - b.week || DAYS.indexOf(a.day) - DAYS.indexOf(b.day));
  const info = sessions[0] || {};
  const [bg] = COURSE_COLORS[course] || ['#888'];
  let rows = sessions.map(s => `
    <div class="modal-session-row">
      <div class="sn">#${s.session}</div>
      <div class="week-badge" style="background:${bg}">Wk${s.week}</div>
      <div>${s.day}</div>
      <div style="font-family:'Space Mono',monospace;font-size:11px">${s.slot.slice(0,5)}</div>
      <div style="color:var(--accent4);font-family:'Space Mono',monospace;font-size:11px">${s.room}</div>
      <div style="color:var(--text-dim);font-size:11px">${s.faculty}</div>
    </div>`).join('');
  document.getElementById('modal-body').innerHTML = `
    <div class="modal-title">${info.course_name || course}</div>
    <div class="modal-sub">
      <span class="course-code" style="background:${bg};color:#0a0c10;padding:3px 8px;border-radius:5px;font-size:11px;font-weight:700;margin-right:8px">${course}</span>
      ${section} ¬∑ ${sessions.length} sessions scheduled ¬∑ ${info.enrollment} students ¬∑ ${info.faculty}
    </div>
    <div class="modal-sessions">${rows}</div>`;
  document.getElementById('modal-overlay').classList.add('open');
}

function showCourseModal(course) {
  showSessionModal(course, 'Sec A', 1);
}

function showFacultyModal(faculty) {
  const sessions = RAW_DATA.filter(d => d.faculty === faculty)
    .sort((a,b) => a.week - b.week || DAYS.indexOf(a.day) - DAYS.indexOf(b.day));
  const courses = [...new Set(sessions.map(d => d.course_name))];
  let rows = sessions.slice(0,30).map(s => `
    <div class="modal-session-row">
      <div class="sn">#${s.session}</div>
      <div class="week-badge">Wk${s.week}</div>
      <div>${s.day} ${s.slot.slice(0,5)}</div>
      <div style="color:var(--accent);font-weight:700;font-size:11px">${s.course}</div>
      <div style="color:var(--text-dim);font-size:11px">${s.section}</div>
      <div style="color:var(--accent4);font-family:'Space Mono',monospace;font-size:11px">${s.room}</div>
    </div>`).join('');
  document.getElementById('modal-body').innerHTML = `
    <div class="modal-title">${faculty}</div>
    <div class="modal-sub">${courses.join(' ¬∑ ')} ¬∑ ${sessions.length} total sessions</div>
    <div class="modal-sessions">${rows}</div>
    ${sessions.length > 30 ? '<div style="font-size:11px;color:var(--text-faint);margin-top:8px">Showing first 30 sessions</div>' : ''}`;
  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal(e) {
  if (e.target === document.getElementById('modal-overlay'))
    document.getElementById('modal-overlay').classList.remove('open');
}
function closeModalBtn() {
  document.getElementById('modal-overlay').classList.remove('open');
}

// Init
renderWeeklyGrid();
renderCourses();
renderFaculty();
renderRooms();
</script>
</body>
</html>
